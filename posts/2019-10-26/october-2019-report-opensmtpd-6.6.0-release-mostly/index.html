<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>October 2019 report: OpenSMTPD 6.6.0 release mostly - poolp.org</title><meta property="og:title" content="October 2019 report: OpenSMTPD 6.6.0 release mostly"><meta name=twitter:title content="October 2019 report: OpenSMTPD 6.6.0 release mostly"><meta name=description content="TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 feature - An OpenSMTPD book is in the works  Shout outs to my patrons ! As usual, a huge thanks goes to the people sponsoring me on patreon or github, the work in this post was made possible by my sponsorship."><meta property="og:description" content="TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 feature - An OpenSMTPD book is in the works  Shout outs to my patrons ! As usual, a huge thanks goes to the people sponsoring me on patreon or github, the work in this post was made possible by my sponsorship."><meta name=twitter:description content="TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 …"><meta name=author content="Gilles Chehade"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"poolp.org","url":"https:\/\/poolp.org\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/poolp.org\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/poolp.org\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/poolp.org\/posts\/2019-10-26\/october-2019-report-opensmtpd-6.6.0-release-mostly\/","name":"October 2019 report open s m t p d 6.6.0 release mostly"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Gilles Chehade"},"headline":"October 2019 report: OpenSMTPD 6.6.0 release mostly","description":"TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 feature - An OpenSMTPD book is in the works  Shout outs to my patrons ! As usual, a huge thanks goes to the people sponsoring me on patreon or github, the work in this post was made possible by my sponsorship.","inLanguage":"en","wordCount":1253,"datePublished":"2019-10-26T16:13:00","dateModified":"2019-10-26T16:13:00","image":"https:\/\/poolp.org\/images\/me.jpg","keywords":[""],"mainEntityOfPage":"https:\/\/poolp.org\/posts\/2019-10-26\/october-2019-report-opensmtpd-6.6.0-release-mostly\/","publisher":{"@type":"Organization","name":"https:\/\/poolp.org\/","logo":{"@type":"ImageObject","url":"https:\/\/poolp.org\/images\/me.jpg","height":60,"width":60}}}</script><meta property="og:title" content="October 2019 report: OpenSMTPD 6.6.0 release mostly"><meta property="og:description" content="TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 feature - An OpenSMTPD book is in the works  Shout outs to my patrons ! As usual, a huge thanks goes to the people sponsoring me on patreon or github, the work in this post was made possible by my sponsorship."><meta property="og:image" content="https://poolp.org/images/2019-10-26-book.pmg"><meta property="og:url" content="https://poolp.org/posts/2019-10-26/october-2019-report-opensmtpd-6.6.0-release-mostly/"><meta property="og:type" content="website"><meta property="og:site_name" content="poolp.org"><meta name=twitter:title content="October 2019 report: OpenSMTPD 6.6.0 release mostly"><meta name=twitter:description content="TL;DR: - yay, surprise emergency hand surgery... - OpenSMTPD 6.6.0 was tagged and released, including portable version - Merged contributions to fix filter-rspamd bug with DKIM - Work resumed on 6.7.0 …"><meta name=twitter:image content="https://poolp.org/images/2019-10-26-book.pmg"><meta name=twitter:card content="summary"><meta name=twitter:site content="@poolpOrg"><meta name=twitter:creator content="@poolpOrg"><meta property="og:image" content="https://poolp.org/images/2019-10-26-book.pmg"><meta name=twitter:image content="https://poolp.org/images/2019-10-26-book.pmg"><meta name=twitter:card content="summary"><meta name=twitter:site content="@poolpOrg"><meta name=twitter:creator content="@poolpOrg"><meta property="og:url" content="https://poolp.org/posts/2019-10-26/october-2019-report-opensmtpd-6.6.0-release-mostly/"><meta property="og:type" content="website"><meta property="og:site_name" content="poolp.org"><meta name=generator content="Hugo 0.78.1"><link rel=alternate href=https://poolp.org/index.xml type=application/rss+xml title=poolp.org><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://poolp.org/css/main.css><link rel=stylesheet href=https://poolp.org/css/highlight.min.css><link rel=stylesheet href=https://poolp.org/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><link rel=stylesheet href=/css/latex.style.css></head><body><div class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://poolp.org/>poolp.org</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li class=navlinks-container><a class=navlinks-parent>Freelance</a><div class=navlinks-children><a href=/en/contracting/>[en] Hire me !</a>
<a href=/fr/contracting/>[fr] Recrutez moi !</a></div></li><li class=navlinks-container><a class=navlinks-parent>Sponsorship</a><div class=navlinks-children><a href=/en/sponsorship/>[en] Sponsor me !</a>
<a href=/fr/sponsorship/>[fr] Sponsorisez moi !</a></div></li><li class=navlinks-container><a class=navlinks-parent>Social</a><div class=navlinks-children><a href=https://patreon.com/gilles>Patreon</a>
<a href=https://www.linkedin.com/in/gilleschehade>LinkedIn</a>
<a href=https://github.com/poolpOrg>Github</a>
<a href=https://twitter.com/poolpOrg>Twitter</a></div></li><li class=navlinks-container><a class=navlinks-parent>Curriculum</a><div class=navlinks-children><a href=https://github.com/poolpOrg/resume/blob/master/resume.en.pdf>EN</a>
<a href=https://github.com/poolpOrg/resume/blob/master/resume.fr.pdf>FR</a></div></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title=poolp.org href=https://poolp.org/><img class=avatar-img src=https://poolp.org/images/me.jpg alt=poolp.org></a></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-heading><h1 style=text-align:left>October 2019 report: OpenSMTPD 6.6.0 release mostly</h1></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><pre><code>TL;DR:
- yay, surprise emergency hand surgery...
- OpenSMTPD 6.6.0 was tagged and released, including portable version
- Merged contributions to fix filter-rspamd bug with DKIM
- Work resumed on 6.7.0 feature
- An OpenSMTPD book is in the works
</code></pre><h2 id=shout-outs-to-my-patrons->Shout outs to my patrons !</h2><p>As usual,
a <strong>huge</strong> thanks goes to the people sponsoring me on <a href=https://www.patreon.com/gilles>patreon</a> or <a href=https://github.com/sponsors/poolpOrg>github</a>, the work in this post was made possible by my <a href=/sponsorship/>sponsorship</a>.</p><h2 id=how-i-landed-in-the-emergencies>How I landed in the emergencies</h2><p>I accidentally cut my hand real bad early October and rushed to the nearest hospital.
They had a look,
told me it was superficial and required to be sutured,
so I was out a few hours later with a few stitches and pain killers.</p><p>A few days later,
my hand was swell so I rushed to another hospital that was specialized in hand wounds,
expecting a second advice and maybe some additional drugs.</p><p>Turns out the cut was not superficial at all,
it had hit joints and needed more than just a few stitches.
The stitches also lacked propre protection so the wound had infected.
I was told that I had to undergo immediate surgery because the infection was looking real bad,
and that I was lucky I took this seriously and came right away.</p><center><img src=/images/2019-10-26-hand.jpg></center><p>So this is how my month of October was ruined.
It took me two weeks to be able to type back on a keyboard,
it is still painful and I&rsquo;m still unable to practice music or martial arts as I can&rsquo;t close my fingers entirely.</p><p>Luckily,
I should be able to recover fully, but&mldr; it will take some time.</p><p>My work this month was obviously impacted,
<strong>BUT</strong> I managed to pull the OpenSMTPD 6.6.0 release and do some thinking work around redesigns planned for development cycle that just started.
I will discuss a bit my plan in this article.</p><h2 id=opensmtpd-660-was-released>OpenSMTPD 6.6.0 was released</h2><p>I have published and <a href=https://www.mail-archive.com/misc@opensmtpd.org/msg04725.html>announced the OpenSMTPD 6.6.0 release</a> today.</p><p>It is a very important release for us,
<strong>probably one of the most important that happened in the last few years</strong>,
as it brings the filter API and makes it possible to compete with other MTA by interfacing with a wide variety of third party tools.</p><p>It is now possible to do dnsbl,
interface with antispam solutions such as Rspamd or SpamAssassin,
perform DKIM signing and verifying at session time,
rejecting sessions that do not behave as we expect,
&mldr;</p><p>The API was released as an undocumented experimental feature.
This doesn&rsquo;t mean it is unstable,
the code has been used on the OpenSMTPD mail exchanger for over a year,
used by developers for at least as long,
and tested by users in the wild for several months.
The only reason it is considered experimental is that we didn&rsquo;t want to &ldquo;release&rdquo; a stable version of the API with easy access to documentation,
without having a chance to obtain a first round of feedback over the course of a release with a limited set of filters and developers ;-)</p><p>In addition to filters,
this is the first release that is considering LibreSSL as its target TLS library <em>while</em> providing support for OpenSSL.
A lot of distributions remained with ancient OpenSMTPD release because of TLS library issues.
This release is going to make every distro and system out there able to catch up and use the latest OpenSMTPD release.</p><h2 id=dkim-signing-and-verifying-was-fixed-in-filter-rspamd>DKIM signing and verifying was fixed in filter-rspamd</h2><p>Thanks to Reio Remma <a href=https://github.com/whataboutpereira>@whataboutpereira</a>,
a bug was fixed in filter-rspamd which would cause some mails to be incorrectly DKIM signed or verified.</p><p>The issue was that filters receive the raw SMTP lines during the DATA phase,
and the filter didn&rsquo;t account for the escaping of lines starting with a dot,
leading to some mails being incorrectly signed or verified.</p><p>His fix was committed to github and prompted me to issue a new release,
before updating the OpenBSD port as well.</p><p>I have received an ok to commit the fix to stable packages and will do so this week-end.</p><h2 id=opensmtpd-67x-work>OpenSMTPD 6.7.x work</h2><p>With my hand out of service,
I spent time thinking about bits that needed a redesign.</p><p>The smtp-out reporting was almost completed and didn&rsquo;t make it to this release,
so I will make sure it is completed very soon so it doesn&rsquo;t miss the next release.</p><p>The switch to libtls requires a standalone OpenSSL-based libtls interface to be written,
I have started taking a look at it too.
I already have a libtls-based OpenSMTPD in a branch,
but I don&rsquo;t want to switch to that until we know for sure that we&rsquo;ll be able to provide a portable release,
so hopefully for 6.7.x in six months and more realistically for 6.8.x in a year.</p><p>The MTA layer needs to be reworked and was discussed at lengths with Eric Faurot,
this would be a change transparent to users but which would make the daemon MUCH simpler for developers.
I hope we can pull that for 6.7.x but work has to start very soon to make this happen,
so we&rsquo;ll see in the next few weeks how this project evolves.</p><p>Finally,
I&rsquo;d like to replace the current table API with one that&rsquo;s similar to the filter API.
The current API is a binary protocol relying on the imsg framework,
requiring C plumbing and making the writing of table backends limited to skilled developers.
I already discussed with Eric Faurot my feeling that it should be converted to a line-based protocol,
similar to filters,
which would allow backends to be written in any language,
providing the same benefits as filters in terms of privilege separation and memory isolation.
This would make the OpenSMTPD-extras repository deprecated,
but given that I&rsquo;m the author for pretty much every addon there,
I think I can easily replace them with new interface counterparts.</p><h2 id=an-opensmtpd-book-is-in-the-works>An OpenSMTPD book is in the works</h2><p>I had started writing a book about OpenSMTPD <strong>years ago</strong> but,
because huge reworks were in progress in both configuration and filter areas,
I kept delaying as I didn&rsquo;t want to write configuration bits that would have to be rewritten from scratch,
and I didn&rsquo;t want the book to lack a chapter about spam filtering.</p><p>With all of the work that has gone through OpenSMTPD in the last two years,
I feel that there&rsquo;s no longer a gap to fill and a very complete and useful book can be written.
I have therefore resumed work and currently have a PDF that&rsquo;s <strong>well over a hundred pages</strong> when fully built,
describing the history and design of OpenSMTPD,
large chunks of how SMTP and DNS work,
how to setup your MX,
how to configure various setups,
and much more.</p><center><img src=/images/2019-10-26-book.png></center><p>Needless to say,
this is a LOT of work.</p><p>It will take months to complete the book and publish something I&rsquo;ll be happy with,
so if you&rsquo;re interested let me know and if you want to support me and help me get this out the sooner,
then you know how to show your love and buy me time :-)</p><h2 id=what-next->What next ?</h2><p>I have started writing a new article related to SMTP and reputation,
I will try to complete it next week and provide early access to my patrons.</p><p>Development cycle for OpenSMTPD as resumed,
I have a few tickets to tackle on Github and a few ideas that I have to dig,
but the table API rework is a very high priority thing to do for me.</p><p>I will also resume working on cleaning up the portability layer.</p><hr><p>Comments: <a href=https://github.com/poolpOrg/poolp.org/issues/22>https://github.com/poolpOrg/poolp.org/issues/22</a></p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f&text=October%202019%20report%3a%20OpenSMTPD%206.6.0%20release%20mostly&via=poolpOrg" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f&title=October%202019%20report%3a%20OpenSMTPD%206.6.0%20release%20mostly" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f&title=October%202019%20report%3a%20OpenSMTPD%206.6.0%20release%20mostly" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f&title=October%202019%20report%3a%20OpenSMTPD%206.6.0%20release%20mostly" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fpoolp.org%2fposts%2f2019-10-26%2foctober-2019-report-opensmtpd-6.6.0-release-mostly%2f&description=October%202019%20report%3a%20OpenSMTPD%206.6.0%20release%20mostly" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://poolp.org/posts/2019-09-21/september-2019-report-jules-opensmtpd-6.6.0-upcoming-release-and-related-things/ data-toggle=tooltip data-placement=top title="September 2019 report: Jules, OpenSMTPD 6.6.0 upcoming release and related things">&larr; Previous Post</a></li><li class=next><a href=https://poolp.org/posts/2019-11-17/november-2019-report-opensmtpd-6.6.1p1-filter-greylist-and-tons-of-portable-cleanup/ data-toggle=tooltip data-placement=top title="November 2019 report: OpenSMTPD 6.6.1p1, filter-greylist and tons of portable cleanup">Next Post &rarr;</a></li></ul></div></div></div><footer style=text-align:justify><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><h2>Like my work and want to help me ?</h2><br><ul><li>Consider <b>tipping me</b> on <b><a target=_blank href=https://paypal.me/poolpOrg>PayPal</a></b>,
<b>supporting me</b> through one of the <b><a href=/en/sponsorship>sponsorship</a></b> platforms at <b><a href=https://github.com/sponsors/poolpOrg>Github</a></b>, <b><a href=https://patreon.com/gilles>Patreon</a></b> or
<b><a href=https://liberapay.com/poolpOrg>LiberaPay</a></b>,
or even <b>getting me something</b> from my wishlist on <b><a target=_blank href=http://amzn.eu/3MwH6CX>Amazon</a></b>
for positive <b><a href=https://en.wikipedia.org/wiki/Reinforcement>reinforcement</a></b> :-)<br><br></li><li>You can also help me by <b>commenting articles</b> to spark discussions,
and by <b>sharing them</b> so they reach a bigger audience,
they all contain a comment link and icons that will let you share to popular social networks.</li></ul><br></div></div><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><p class="credits copyright text-muted"><a href=https://poolp.org>Gilles Chehade</a>
-&nbsp;&copy;
2020
-
<a href=https://poolp.org/>poolp.org</a></p><p class="credits theme-by text-muted"><a href=http://gohugo.io>Hugo v0.78.1</a> powered - Theme adapted from <a href=http://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://poolp.org/js/main.js></script><script src=https://poolp.org/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0");});</script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://poolp.org/js/load-photoswipe.js></script></body></html>